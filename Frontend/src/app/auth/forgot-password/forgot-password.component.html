<div class="forgot-page">
  <div class="forgot-card">
    <div class="card-header">
      <mat-icon>lock_reset</mat-icon>
      <h1>Forgot Password</h1>
    </div>

    <!-- Step 1: Enter Email -->
    @if (step === 1) {
      <p class="subtitle">Enter your registered email to receive OTP.</p>
      
      <div class="input-group">
        <mat-icon>email</mat-icon>
        <input type="email" [(ngModel)]="email" placeholder="Enter your email">
      </div>

      <button class="submit-btn" (click)="sendOTP()" [disabled]="isLoading">
        @if (isLoading) {
          <span>Sending OTP...</span>
        } @else {
          <span>Send OTP</span>
          <mat-icon>send</mat-icon>
        }
      </button>
    }


    @if (step === 2) {
      <p class="subtitle">Enter the 6-digit OTP sent to <strong>{{email}}</strong></p>

      <div class="input-group otp-input">
        <mat-icon>pin</mat-icon>
        <input type="text" [(ngModel)]="otp" placeholder="Enter 6-digit OTP" 
               (input)="onOtpInput($event)" maxlength="6">
      </div>

      <button class="submit-btn" (click)="verifyOTP()" [disabled]="isLoading">
        @if (isLoading) {
          <span>Verifying...</span>
        } @else {
          <span>Verify OTP</span>
          <mat-icon>check</mat-icon>
        }
      </button>

      <div class="resend-section">
        @if (resendTimer > 0) {
          <span class="timer">Resend OTP in {{resendTimer}}s</span>
        } @else {
          <button class="resend-btn" (click)="resendOTP()">Resend OTP</button>
        }
      </div>
    }

 
    @if (step === 3) {
      <p class="subtitle">OTP verified! Enter your new password.</p>

      <div class="input-group">
        <mat-icon>lock</mat-icon>
        <input [type]="hidePassword ? 'password' : 'text'" [(ngModel)]="newPassword" placeholder="New Password">
        <button type="button" class="toggle-btn" (click)="hidePassword = !hidePassword">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
      </div>

      <div class="input-group">
        <mat-icon>lock_outline</mat-icon>
        <input [type]="hidePassword ? 'password' : 'text'" [(ngModel)]="confirmPassword" placeholder="Confirm Password">
      </div>

      <button class="submit-btn" (click)="resetPassword()" [disabled]="isLoading">
        @if (isLoading) {
          <span>Resetting...</span>
        } @else {
          <span>Reset Password</span>
          <mat-icon>check</mat-icon>
        }
      </button>
    }

   
    @if (step === 4) {
      <div class="success-message">
        <mat-icon>check_circle</mat-icon>
        <h2>Password Reset!</h2>
        <p>Your password has been updated successfully.</p>
        <button class="login-btn" (click)="goToLogin()">
          Go to Login <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    }

    @if (step !== 4) {
      <a routerLink="/login" class="back-link">
        <mat-icon>arrow_back</mat-icon> Back to Login
      </a>
    }
  </div>
</div>
