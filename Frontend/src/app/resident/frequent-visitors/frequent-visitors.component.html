<div class="frequent-page">
  <div class="page-header">
    <div>
      <h1>Frequent Visitors</h1>
      <p>Manage your regular visitors for quick approvals</p>
    </div>
    <button mat-raised-button color="primary" (click)="toggleAddForm()">
      <mat-icon>{{ showAddForm ? 'close' : 'person_add' }}</mat-icon>
      {{ showAddForm ? 'Cancel' : 'Add Visitor' }}
    </button>
  </div>

  <!-- Add Visitor Form -->
  @if (showAddForm) {
    <div class="add-form-card">
      <h2>Add Frequent Visitor</h2>
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Visitor Name</mat-label>
          <input matInput [(ngModel)]="newVisitor.name" placeholder="Enter name" required>
          <mat-icon matPrefix>person</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Phone Number</mat-label>
          <input matInput [(ngModel)]="newVisitor.phone" placeholder="Enter 10-digit phone" 
                 maxlength="10" required>
          <mat-icon matPrefix>phone</mat-icon>
          @if (newVisitor.phone && newVisitor.phone.length > 0 && newVisitor.phone.length < 10) {
            <mat-hint class="error-hint">Phone must be 10 digits ({{newVisitor.phone.length}}/10)</mat-hint>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Relation</mat-label>
          <mat-select [(ngModel)]="newVisitor.relation" required>
            @for (rel of relationTypes; track rel) {
              <mat-option [value]="rel">{{ rel }}</mat-option>
            }
          </mat-select>
          <mat-icon matPrefix>group</mat-icon>
        </mat-form-field>
      </div>
      
      @if (showError && !isFormValid) {
        <div class="error-message">
          <mat-icon>warning</mat-icon> Please fill all fields correctly (phone must be 10 digits)
        </div>
      }
      
      <div class="form-actions">
        <button mat-raised-button color="primary" (click)="addVisitor()" [disabled]="!isFormValid">
          <mat-icon>add</mat-icon> Add Visitor
        </button>
        <button mat-stroked-button (click)="toggleAddForm()">Cancel</button>
      </div>
    </div>
  }

  <div class="table-card">
    <div class="table-header">
      <h2>Your Regular Visitors ({{ frequentVisitors.length }})</h2>
      <mat-form-field appearance="outline">
        <mat-label>Search</mat-label>
        <input matInput [(ngModel)]="searchQuery" placeholder="Search by name or relation">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="filteredVisitors">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let v">
          <div class="visitor-info">
            <mat-icon>person</mat-icon>
            <span>{{v.name}}</span>
          </div>
        </td>
      </ng-container>
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>Phone</th>
        <td mat-cell *matCellDef="let v">{{v.phone}}</td>
      </ng-container>
      <ng-container matColumnDef="relation">
        <th mat-header-cell *matHeaderCellDef>Relation</th>
        <td mat-cell *matCellDef="let v">
          <span class="relation-badge">{{v.relation}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="visits">
        <th mat-header-cell *matHeaderCellDef>Total Visits</th>
        <td mat-cell *matCellDef="let v">
          <span class="visits-count">{{v.visits}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="lastVisit">
        <th mat-header-cell *matHeaderCellDef>Last Visit</th>
        <td mat-cell *matCellDef="let v">{{v.lastVisit}}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let v">
          <button mat-icon-button color="warn" (click)="removeVisitor(v)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>
