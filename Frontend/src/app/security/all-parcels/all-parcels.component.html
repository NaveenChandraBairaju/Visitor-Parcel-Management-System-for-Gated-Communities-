<div class="all-parcels-page">
  <div class="page-header">
    <div>
      <h1>All Parcels</h1>
      <p>View and manage all parcel records</p>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-card total" (click)="statusFilter = 'all'">
      <mat-icon>inventory_2</mat-icon>
      <div class="stat-info">
        <span class="stat-num">{{totalCount}}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>
    <div class="stat-card pending" (click)="statusFilter = 'Pending'">
      <mat-icon>hourglass_empty</mat-icon>
      <div class="stat-info">
        <span class="stat-num">{{pendingCount}}</span>
        <span class="stat-label">Pending</span>
      </div>
    </div>
    <div class="stat-card approved" (click)="statusFilter = 'Approved'">
      <mat-icon>check_circle</mat-icon>
      <div class="stat-info">
        <span class="stat-num">{{approvedCount}}</span>
        <span class="stat-label">Approved</span>
      </div>
    </div>
    <div class="stat-card collected" (click)="statusFilter = 'Collected'">
      <mat-icon>inventory_2</mat-icon>
      <div class="stat-info">
        <span class="stat-num">{{collectedCount}}</span>
        <span class="stat-label">Collected</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-row">
    <mat-form-field appearance="outline">
      <mat-label>Search</mat-label>
      <input matInput [(ngModel)]="searchQuery" placeholder="Search by name, flat, courier, or recipient">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Status Filter</mat-label>
      <mat-select [(ngModel)]="statusFilter">
        <mat-option value="all">All Status</mat-option>
        <mat-option value="Pending">Pending Approval</mat-option>
        <mat-option value="Approved">Approved</mat-option>
        <mat-option value="Rejected">Rejected</mat-option>
        <mat-option value="Collected">Collected</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Table -->
  <div class="table-card">
    <h2>Parcel Records ({{filteredParcels.length}})</h2>
    <table mat-table [dataSource]="filteredParcels">
      <ng-container matColumnDef="courier">
        <th mat-header-cell *matHeaderCellDef>Courier</th>
        <td mat-cell *matCellDef="let p">
          <span class="courier-badge">{{p.courier}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Parcel Name</th>
        <td mat-cell *matCellDef="let p">{{p.name}}</td>
      </ng-container>
      <ng-container matColumnDef="flatNumber">
        <th mat-header-cell *matHeaderCellDef>Flat</th>
        <td mat-cell *matCellDef="let p">
          <span class="flat-badge">{{p.flatNumber}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="recipientName">
        <th mat-header-cell *matHeaderCellDef>Recipient</th>
        <td mat-cell *matCellDef="let p">{{p.recipientName}}</td>
      </ng-container>
      <ng-container matColumnDef="receivedDate">
        <th mat-header-cell *matHeaderCellDef>Received</th>
        <td mat-cell *matCellDef="let p">
          <div class="date-time">
            <span>{{p.receivedDate}}</span>
            <span class="time">{{p.receivedTime}}</span>
          </div>
        </td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let p">
          <span class="status-badge" [ngClass]="getStatusClass(p.status)">{{p.status}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="deliveryPerson">
        <th mat-header-cell *matHeaderCellDef>Delivery Person</th>
        <td mat-cell *matCellDef="let p">
          @if (p.deliveryPersonName) {
            <div class="delivery-info">
              <span class="delivery-name">{{p.deliveryPersonName}}</span>
              @if (p.deliveryPersonLeft) {
                <span class="delivery-status left">
                  <mat-icon>check_circle</mat-icon> Left {{p.deliveryPersonLeft}}
                </span>
              } @else {
                <div class="delivery-actions">
                  <span class="delivery-status inside">
                    <mat-icon>login</mat-icon> In: {{p.deliveryPersonArrived}}
                  </span>
                  <button mat-raised-button color="warn" class="exit-btn" (click)="markDeliveryLeft(p)">
                    <mat-icon>logout</mat-icon> Exit
                  </button>
                </div>
              }
            </div>
          } @else {
            <span class="no-info">-</span>
          }
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    @if (filteredParcels.length === 0) {
      <div class="empty-state">
        <mat-icon>inventory_2</mat-icon>
        <p>No parcels found</p>
      </div>
    }
  </div>
</div>
